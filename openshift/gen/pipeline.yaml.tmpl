---
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: {{pipeline_name}}
spec:
  {%if workspaces %}
  workspaces:
    {% for workspace in workspaces -%}
    - name: {{ workspace }}
    {% endfor %}
  {% endif %}
  {%if resources %}
  resources:
    {% for resource in resources -%}
    - name: {{ resource[1] }}
      type: {{ resource[0] }}
    {% endfor %}
  {% endif %}
  tasks:
{% filter indent(width=4) %}
{% for step in steps -%}
{{ step }}
{% endfor %}
{% endfilter %}

---
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  name: {{pipeline_name}}-run
spec:
  {% if serviceAccountName -%}
  serviceAccountName: {{serviceAccountName}}
  {% endif %}
  pipelineRef:
    name: {{pipeline_name}}
  {%if workspaces %}
  workspaces:
    {% for workspace in workspaces -%}
    - name: {{ workspace }}
      persistentvolumeclaim:
        claimName: {{workspace}}
    {% endfor %}
  {% endif %}
  {%if resources %}
  resources:
    {% for resource in resources -%}
    - name: {{ resource[1] }}
      resourceRef:
        name: {{resource[1]}}
    {% endfor %}
  {% endif %}
